{{ define "main" }}
<div class="hero min-h-screen bg-base-200">
    <div class="hero-content w-full max-w-5xl">
        <div class="w-full">
            <h1 class="text-3xl font-bold mb-8 dark:text-white text-center">Suche</h1>
            
            <div class="mb-8 max-w-2xl mx-auto">
                <div class="relative">
                    <input type="text" id="search-input" 
                           class="w-full p-4 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-neutral-500 bg-gray-200 dark:bg-neutral dark:text-white dark:border-neutral-700"
                           placeholder="Suchbegriff eingeben...">
                </div>
            </div>

            <div id="search-results" class="grid grid-cols-1 gap-6 text-left">
                <!-- Suchergebnisse werden hier dynamisch eingef端gt -->
            </div>
        </div>
    </div>
</div>

{{ partial "search-result-template.html" . }}

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const resultTemplate = document.querySelector('.js-search-result-template').innerHTML;
    const imageTemplate = document.querySelector('.js-image-template').innerHTML;
    const noImageTemplate = document.querySelector('.js-no-image-template').innerHTML;
    const tagTemplate = document.querySelector('.js-tag-template').innerHTML;
    
    function createSearchResult(result) {
        let html = resultTemplate;
        
        // Ersetze Platzhalter im Template
        html = html.replace('{{"{{"}} permalink {{"}}"}}', result.item.permalink)
                  .replace('{{"{{"}} title {{"}}"}}', highlightText(result.item.title, searchTerm))
                  .replace('{{"{{"}} description {{"}}"}}', getContextSnippet(result.item.content, searchTerm));
        
        // F端ge Bild hinzu
        const imageContainer = document.createElement('div');
        if (result.item.images && result.item.images.thumb) {
            imageContainer.innerHTML = imageTemplate
                .replace('{{"{{"}} imageUrl {{"}}"}}', result.item.images.thumb)
                .replace('{{"{{"}} imageAlt {{"}}"}}', result.item.title);
        } else {
            imageContainer.innerHTML = noImageTemplate;
        }
        
        // F端ge Tags hinzu
        const tagsHtml = result.item.tags ? result.item.tags.map(tag => 
            tagTemplate.replace('{{"{{"}} tag {{"}}"}}', tag)
        ).join('') : '';
        
        return html.replace('<!-- Tags werden dynamisch eingef端gt -->', tagsHtml);
    }

    // Rest der Suchlogik bleibt gleich...
    function highlightText(text, searchTerm) {
        if (!searchTerm) return text;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<mark class="bg-amber-200 dark:bg-amber-700 dark:text-white">$1</mark>');
    }

    function getContextSnippet(content, searchTerm, maxLength = 200) {
        if (!content || !searchTerm) return '';
        
        const lowerContent = content.toLowerCase();
        const lowerSearchTerm = searchTerm.toLowerCase();
        const index = lowerContent.indexOf(lowerSearchTerm);
        
        if (index === -1) return content.slice(0, maxLength) + '...';
        
        const start = Math.max(0, index - 100);
        const end = Math.min(content.length, index + 100);
        return (start > 0 ? '...' : '') + 
               content.slice(start, end) +
               (end < content.length ? '...' : '');
    }
});
</script>
{{ end }} 